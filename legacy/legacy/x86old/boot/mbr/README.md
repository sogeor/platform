Sogeor Platform x86 MBR Boot
============================

Это начальный загрузчик (далее — НЗ) платформы Sogeor (далее — SP) на архитектуре x86. Он основан на главной загрузочной
записи (далее — MBR). Он способен обнаружить ядро, драйвера SP и загрузить их в оперативную память (далее — RAM). Он
способен полноценно функционировать как в реальном (далее — RM) и защищённом (далее — PM), так и в длинном режиме
(далее — LM). Он состоит из следующих ступеней:

### 1. Ступень MBR (`/mbrstage/*`):

1. Подготавливает центральный процессор (далее — ЦП) к работе.
2. Загружает ступень RM в RAM с помощью базовой системы ввода-вывода (далее — BIOS).
    - Если не удалось, то выводит следующее сообщение: "`Failed to load rmstage sectors`" — и переходит к бесконечной
      остановке процессора.
3. Подготавливает загрузочную информацию для ступени RM.
4. Передаёт управление ступени RM.

### 2. Ступень RM (`/rmstage/*`):

1. Подготавливает ЦП к работе.
2. Анализирует загрузочную информацию.
    - Если не удалось, то выводит следующее сообщение: "`Failed to analyze rmstage boot information`" — и переходит к
      бесконечной остановке процессора.
3. Подготавливает линию A20:
    - Проверяет линию A20.
        - Если линия A20 включена, то переходит к 4 шагу.
    - Пытается включить линию A20 с помощью BIOS.
    - Проверяет линию A20.
        - Если линия A20 включена, то переходит к 4 шагу.
    - Пытается включить линию A20 с помощью контроллера PS/2.
    - Проверяет линию A20.
        - Если линия A20 включена, то переходит к 4 шагу.
    - Пытается включить линию A20 с помощью порта ввода-вывода `0x92`.
    - Проверяет линию A20.
        - Если линия A20 включена, то переходит к 4 шагу.
    - Пытается включить линию A20 с помощью порта ввода-вывода `0xEE`.
        - Если не удалось, то выводит следующее сообщение: "`Failed to prepare A20 line`" — и переходит к бесконечной
          остановке процессора.
4. Загружает ступень PM в RAM с помощью BIOS.
    - Если не удалось, то выводит следующее сообщение: "`Failed to load pmstage sectors`" — и переходит к бесконечной
      остановке процессора.
5. Подготавливает загрузочную информацию для ступени PM.
6. Передаёт управление ступени PM.

### Ступень PM (`/pmstage/*`):

1. Подготавливает ЦП к работе.
2. Анализирует загрузочную информацию.
    - Если не удалось, то выводит следующее сообщение: "`Failed to analyze pmstage boot information`" — и переходит к
      бесконечной остановке процессора.
3. Выключает все прерывания, в том числе NMI (Non Maskable Interrupt).
4. Настраивает IDT (Interrupt Descriptor Table).
5. Настраивает GDT (Global Descriptor Table).
6. Переходит в защищённый режим.
7. ... (*Доделать*)
8. Если процессор не поддерживает 64-разрядные инструкции, то она переходит к 11 пункту.
9. Подготавливает необходимую загрузочную информацию для ступени длинного режима и записывает её сразу после себя.
10. Пытается загрузить ступень длинного режима в память сразу после необходимой для неё загрузочной информации,
    используя ~~прерывание BIOS `0x42:13h`~~: (*Мне кажется, что стоит попробовать написать драйвер для диска и файловой
    системы*)
    - Если никаких ошибок не возникло, то она передаёт управление начальному адресу ступени длинного режима.
    - В противном случае она выводит следующее сообщение: "`Failed to read lstage sectors`" — и переходит к бесконечной
      остановке процессора.
11. ... (*Доделать*)
12. Поиск и загрузка ядра?

### Ступень LM (`/lmstage/*`):

1. Подготавливает все необходимые регистры.
2. Проверяет свою необходимую загрузочную информацию.
    - Если своя необходимая загрузочная информация некорректна, то она выводит следующее
      сообщение: "`Failed to boot due to incorrect lstage required boot information`" — и переходит к бесконечной
      остановке процессора.
3. ... (*Доделать*)
4. Поиск и загрузка ядра?

~~Окончательная ступень пытается убедиться в пригодности ЭВМ для запуска любого из поколений SP с помощью APM, ACPI и
прочих интерфейсов. Однако если они недоступны, то она выводит следующее сообщение: "()" — и переходит к бесконечной
остановке процессора. Потом она выполняет поиск файловой системы.~~
